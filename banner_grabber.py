from tkinter import *
import socket
from tkinter import filedialog
from tkinter import messagebox
import sys
class banner_grabber_class(Toplevel):
    def __init__(self):
        Toplevel.__init__(self)
        self.geometry('280x130')
        self.maxsize(280,130)
        self.title('Banner Grabber')
        self.iconbitmap('logo/Cap-america-shield.ico')
        self.list=[]
        global list
        list=self.list
        self.frame = Frame(self, height=10, bg='#494949')
        self.frame.pack(fill=X)
        self.middle_frame = LabelFrame(self, text='  Banner Grabber  ', font='Arial 10 bold', bg='#494949', bd=10, fg='white')
        self.middle_frame.pack()

        self.domain_lbl = Label(self.middle_frame, text=' Enter Domain Or IP', bg='#494949', fg='white')
        self.domain_lbl.grid(row=0, column=0, sticky=W)
        self.domain = Entry(self.middle_frame, width=20)
        self.domain.insert(0,'www.dell.com')
        self.domain.grid(row=0, column=1, padx=15, pady=5)
        self.port_lbl = Label(self.middle_frame, text=' Enter Port', bg='#494949', fg='white')
        self.port_lbl.grid(row=1, column=0, sticky=W)
        self.port = Entry(self.middle_frame, width=20)
        self.port.insert(0,80)
        self.port.grid(row=1, column=1, padx=5, pady=5)
        self.grab_button = Button(self.middle_frame, text='Grab Banner', bg='#494949', height=1,command=self.grab_warning, fg='white')
        self.grab_button.grid(row=3, column=1, sticky=EW, padx=5, pady=5)

    def grab_banner(self):
        domain=self.domain.get()
        port=self.port.get()
        try:
            domain = socket.gethostbyname(domain)
        except socket.gaierror as error:
            error_msg=messagebox.showerror('Error',error)
            self.destroy()
        s = socket.socket()
        try:
            s.connect((domain, int(port)))
        except OSError as error:
            self.destroy()
        http_get = ("Get /HTTP/1.1\nHost:{}\n\n".format(domain))
        http_get = http_get.encode('utf-8')
        try:
            s.sendall(http_get)
            data = s.recvfrom(1024)
            strdata = data[0]
            headers = strdata.splitlines()
            for header in headers:
               header = header.decode('utf-8')+'\n'
               self.list.append(header)
        except socket.error as error:
            self.destroy()
        finally:
            s.close()
            self.destroy()
            self.grabe_result_class()

    def grab_warning(self):
        mbox=messagebox.askokcancel('Warning', 'Performing banner grab without permission is illegal perform it at your own risk',icon='warning')
        if mbox==True:
            self.grab_banner()

    class grabe_result_class(Toplevel):
        def __init__(self):
            Toplevel.__init__(self)
            self.geometry('645x515')
            self.maxsize(645,515)
            self.title('Result')
            self.iconbitmap('logo/Cap-america-shield.ico')
            self.result_box=Text(self,width=80,height=30,bg='#494949', wrap=WORD,fg='white')
            self.result_box.pack()
            self.save_frame=Frame(self,height=10,bg='#494949')
            self.save_frame.pack(fill=X)
            self.save_button=Button(self.save_frame,text='      Save      ', bg='#494949',command=self.save_file,fg='white')
            self.save_button.pack(pady=2)
            for i in list :
                self.result_box.insert(END, i)

        def save_file(self):
            file=filedialog.asksaveasfile(mode='w', defaultextension='.txt')
            if file== None:
                return
            data=self.result_box.get(1.0, 'end-1c')
            file.write(data)
